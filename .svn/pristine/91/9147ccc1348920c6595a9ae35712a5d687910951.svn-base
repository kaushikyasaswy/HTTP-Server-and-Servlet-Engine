package edu.upenn.cis.cis455.webserver;
import java.io.*;
import java.net.*;
import java.util.*;

public class Handler extends Thread{

	private final Queue<Socket> Q;
	
	public Handler(Queue Q) {
		this.Q = Q;
	}
	
	public void run() {
		while(true) {
		String request;
		synchronized(Q) {
			while(Q.isEmpty()) {
				try {
					Q.wait();
				} catch (InterruptedException e) {
					e.printStackTrace();
				} }
			Socket clientSocket = Q.remove();
			//Process request and send response
			try {
				PrintWriter out = new PrintWriter(clientSocket.getOutputStream(), true);
				BufferedReader in = new BufferedReader(new InputStreamReader(clientSocket.getInputStream()));
				while ((request = in.readLine()) != null) {
					System.out.println(request);
				}
				System.out.println("Request Done");
				System.out.println(Thread.currentThread());
				
			}
			catch(IOException e) {
				e.printStackTrace();
			}
			Q.notifyAll();
		}
	}
	}
}
